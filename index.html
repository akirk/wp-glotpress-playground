<!DOCTYPE html>
<html>
	<head>
		<title>WordPress Playground</title>
	</head>
	<body>
		<iframe id="wp" style="width: 1200px; height: 800px"></iframe>
		<script type="importmap">
			{
				"imports": {
					"@wp-playground/client": "https://unpkg.com/@wp-playground/client/index.js"
				}
			}
		</script>
		<script type="module">
			import { connectPlayground, login, installPluginsFromDirectory } from '@wp-playground/client';
			let response;
			const client = await connectPlayground(
				document.getElementById('wp'),
				{ loadRemote: 'https://playground.wordpress.net/remote.html' }
			);
			await client.isReady();
			await login(client, 'admin', 'password');
			await installPluginsFromDirectory( client, ['glotpress-local'] );
			await client.mkdirTree('/wordpress/wp-content/languages');

			await fetch( '/translate-proxy?url=' + escape( 'https://translate.wordpress.org/projects/wp/dev/de/default/export-translations?format=po' ) )
			  .then(response => client.writeFile( '/wordpress/wp-content/languages/de_DE.po', new Uint8Array(response.arrayBuffer()) ) );
			await fetch( '/translate-proxy?url=' + escape( 'https://translate.wordpress.org/projects/wp/dev/de/default/export-translations?format=mo' ) )
			  .then(response => client.writeFile( '/wordpress/wp-content/languages/de_DE.mo', new Uint8Array(response.arrayBuffer()) ) );
			await fetch( '/translate-proxy?url=' + escape( 'https://translate.wordpress.org/projects/wp/dev/admin/de/default/export-translations?format=po' ) )
			  .then(response => client.writeFile( '/wordpress/wp-content/languages/admin-de_DE.po', new Uint8Array(response.arrayBuffer()) ) );
			await fetch( '/translate-proxy?url=' + escape( 'https://translate.wordpress.org/projects/wp/dev/admin/de/default/export-translations?format=mo' ) )
			  .then(response => client.writeFile( '/wordpress/wp-content/languages/admin-de_DE.mo', new Uint8Array(response.arrayBuffer()) ) );
			response = await client.run({
			                code: `<?php
include "wordpress/wp-load.php";
update_option("WPLANG","de_DE");
update_option("permalink_structure","/%year%/%monthnum%/%day%/%postname%/");
update_option("gp_enable_local_translation",1);
update_option("gp_enable_inline_translation",1);
					            `});
			console.log(response.text);
			//await client.goTo('/wp-admin/plugins.php');
			await client.goTo('/wp-admin/admin.php?page=local-glotpress');
		</script>
	</body>
</html>
